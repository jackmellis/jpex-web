!function(e,t){!function(e){e.defaults={defaults:[],apply:function(e){this.defaults.forEach(function(t){t(e)})}}}(t),function(e){e.factories={factories:{},apply:function(e){var t=this,r=function(){return r.Factory.apply(e,arguments)};Object.keys(t.factories).forEach(function(n){var c=t.factories[n];r[n]=c.bind(e)}),e.Register=r}}}(t),function(e){function t(e,t,n,c,o){if(!t||!t.dependencies)return[];o||(o=[]),n||(n={});var i=[].concat(t.dependencies).map(function(t){return"object"==typeof t?Object.keys(t).map(function(c){r(e,c,t[c],n,o)}):[r(e,t,c,n,o)]});return Array.prototype.concat.apply([],i)}function r(o,i,a,f,u){var s;if(f||(f={}),"$options"===i)return a;if("$namedParameters"===i)return f;var l=c(i);if(l&&(i=l,o._parent))return r(o._parent,i,a,f,[]);var p=n(i);p&&(i=p,p=!0);var v,y=o._interfaces[i];if(y&&(v=e.resolver.interfaceService.findFactory(o,i),v&&v!==i)){var d=i;i=v,v=d,d=null}if(v?(s=f[v],void 0===s&&Object.keys(f).forEach(function(t){e.resolver.interfaceService.factoryImplements(o,t,v)&&(s=f[t])})):s=f[i],void 0!==s)return e.resolver.interfaceService.validateInterface(o,y,s),s;if(u.indexOf(i)>-1&&e.jpexError(["Recursive loop for dependency",i,"encountered"].join(" ")),s=e.resolver.factoryService.getFactory(o,i,p),!s)return s;if(s.resolved)return s.value;if(s.constant){var h=s.value;return e.resolver.interfaceService.validateInterface(o,y,h),f=e.resolver.factoryService.cacheResult(o,i,s,h,f),h}var b;if(s.dependencies&&s.dependencies.length)try{b=t(o,s,f,a,u.concat(i))}catch(e){if(p)return;throw e}var g=s.fn.apply(o,b);return e.resolver.interfaceService.validateInterface(o,y,g),f=e.resolver.factoryService.cacheResult(o,i,s,g,f),g}function n(e){if("_"===e[0]){var t=e.split("_");if(""===t[t.length-1])return t.shift(),t.pop(),e=t.join("_")}return!1}function c(e){if("^"===e[0])return e.substr(1)}e.resolver={extractParameters:function(e){var t=/\/\*(.*)\*\//g,r="(",n=")",c="=>",o=",",i=e.toString().replace(t,""),a=i.indexOf(r),f=i.indexOf(n),u=i.indexOf(c);return u>-1&&(u<a||a<0)?(i=i.substring(0,u).trim(),i?[i]:[]):(i=i.substring(a+1,f),i?i.split(o).map(function(e){return e.trim()}):[])},resolveDependencies:function(e,r,n){return t(e,r,n)},resolve:function(e,t,n){return r(e,t,null,n,[])}}}(t),function(e){e.privates={getters:{},manual:{NamedParameters:function(e,t,r){r&&"object"==typeof r||(r={});var n=0;return e&&t&&e.forEach(function(e){"object"==typeof e?Object.keys(e).forEach(function(e){void 0===r[e]&&void 0!==t[n]&&(r[e]=t[n]),n++}):(void 0===r[e]&&void 0!==t[n]&&(r[e]=t[n]),n++)}),r},InvokeParent:function(e,t,r,n){r&&!Array.isArray(r)&&(r=Array.from(r)),n=this.NamedParameters(r,n),e.call(t,n)}},properties:{},apply:function(e,t,r){Object.keys(this.getters).forEach(function(r){Object.defineProperty(e,r,{value:this.getters[r].bind(e,t)})}),Object.keys(this.properties).forEach(function(t){e[t]=this.properties[t].call(e)}),Object.defineProperties(e,{NamedParameters:{value:this.manual.NamedParameters.bind(e,r)},InvokeParent:{value:this.manual.InvokeParent.bind(e,t)},_parent:{value:t},_factories:{writable:!0,value:Object.create(t._factories||null)},_resolved:{writeable:!0,value:{}},_interfaces:{writeable:!0,value:Object.create(t._interfaces||null)},_folders:{writable:!0,value:[]}})}}}(t),function(e){e.defaults.defaults.push(function(e){e.Register.Factory("$copy",["$typeof"],function(e){var t=function(r,n,c){switch(e(r)){case"string":case"number":case"boolean":case"function":case"null":case"undefined":return r;case"date":return new Date(r);case"regexp":var o=[];return r.global&&o.push("g"),r.ignoreCase&&o.push("i"),new RegExp(r.source,o.join(""));case"array":return(n||[]).concat(r.map(function(e){return c?t(e):e}));case"object":return n=n||{},Object.keys(r).forEach(function(e){n[e]=c?t(r[e],n[e],c):r[e]}),n;default:throw new Error("Unexpected type: "+e(r))}},r=function(e){return r.shallow(e)};return r.shallow=function(e){return t(e)},r.deep=function(e){return t(e,null,!0)},r.extend=function(){var e=Array.from(arguments),r=e.shift();return e.forEach(function(e){t(e,r,!0)}),r},r}).lifecycle.application()})}(t),function(e){e.defaults.defaults.push(function(e){e.Register.Interface("$ierror",function(e){return e.functionWith({define:e.function,default:e.function,Error:e.function})}),e.Register.Factory("$error","$errorFactory",function(e){return e}).interface("$ierror").lifecycle.application()})}(t),function(e){e.defaults.defaults.push(function(t){t.Register.Factory("$errorFactory",null,function(){var t=function(){t.default.throw.apply(t.default,arguments)};return t.define=function(r,n){var c=function(e){this.message=e,this.name=r,this.stack=(new Error).stack,n&&n.apply(this,arguments)};return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c.create=function(){var t=Array.prototype.slice.call(arguments);t.unshift(c);var r=e.instantiator(this,t);return r},c.throw=function(){throw this.create.apply(this,arguments)},t[r]=c,c},t.default=t.define("Error"),t}).lifecycle.none()})}(t),function(e){e.defaults.defaults.push(function(e){e.Register.Interface("$ilog",function(e){return e.functionWith({log:e.function,info:e.function,warn:e.function,error:e.function})}),e.Register.Factory("$log",null,function(){var e=function(){console.log.apply(console,arguments)};return e.log=console.log,e.info=console.info,e.warn=console.warn,e.error=console.error,e}).interface("$ilog").lifecycle.application()})}(t),function(e){e.defaults.defaults.push(function(t){t.Register.Factory("$resolve",null,function(){var t=this;return function(r,n){return e.resolver.resolve(t,r,n)}}).lifecycle.class()})}(t),function(e){e.defaults.defaults.push(function(e){e.Register.Interface("$itimeout",function(e){return e.function}),e.Register.Interface("$iinterval",function(e){return e.function}),e.Register.Constant("$timeout",setTimeout).interface("$itimeout"),e.Register.Constant("$interval",setInterval).interface("$iinterval")})}(t),function(e){e.defaults.defaults.push(function(e){e.Register.Factory("$typeof",null,function(){var e=["number","boolean","string","array","function","date","regexp","null","undefined"];return function(t,r){var n=Object.prototype.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase();return!r&&e.indexOf(n)<0?"object":n}}).lifecycle.application()})}(t),function(e){e.factories.factories.Constant=function(t,r){return this._factories[t]={value:r,constant:!0},e.factories.wrapper(this._factories[t]).lifecycle.application()}}(t),function(e){e.factories.factories.Enum=function(e,t){var r={},n=-1;return[].concat(t).forEach(function(e){switch(typeof e){case"object":Object.keys(e).forEach(function(t){var c=e[t];r[t]=c,"number"==typeof c&&c>n&&(n=c)});break;case"string":case"number":r[e]=++n}}),Object.freeze(r),this.Register.Constant(e,r)}}(t),function(e){e.factories.factories.ErrorType=function(e,t){return Object.hasOwnProperty.call(this._factories,"_errorTypes")||this.Register.Constant("_errorTypes",[]),this._factories._errorTypes.value.push({name:e,fn:t}),Object.hasOwnProperty.call(this._factories,"$errorFactory")||this.Register.Factory("$errorFactory",["^$errorFactory","_errorTypes"],function(e,t){return t.forEach(function(t){e.define(t.name,t.fn)}),e}),Object.hasOwnProperty.call(this._factories,"$error")||this.Register.Factory("$error","$errorFactory",function(e){return e}).interface("$ierror").lifecycle.application(),this}}(t),function(e){e.factories.factories.Factory=function(t,r,n,c){if("function"==typeof r&&(c=n,n=r,r=null),"function"!=typeof n)return this;r=r?[].concat(r):e.resolver.extractParameters(n),r.length||(r=null);var o={fn:n,dependencies:r};return this._factories[t]=o,e.factories.wrapper(o).lifecycle[c?"application":"instance"]()}}(t),function(e){var t={string:"",number:0,null:null,boolean:!0,object:{},array:[],function:function(){},arrayOf:function(){return[t.either.apply(t,arguments)]},functionWith:function(e){var t=function(){};return Object.keys(e).forEach(function(r){t[r]=e[r]}),t},either:function(){var e=Array.prototype.slice.call(arguments);return 1===e.length?e[0]:(e.iType="either",e)},any:function(){var e=[];return e.iType="any",e}};e.factories.factories.Interface=function(r,n,c){return c&&(c=[].concat(c)),this._interfaces[r]={name:r,pattern:n(t),interface:c},e.factories.wrapper(this._interfaces[r])}}(t),function(e){function t(e,t,r,n){function c(){var e=Array.prototype.slice.call(arguments),n={},c=1;return t.forEach(function(t,r){if(0!==r)if("object"==typeof t)Object.keys(t).forEach(function(t){var r=e[c++];void 0!==r&&(n[t]=r)});else{var o=e[c++];void 0!==o&&(n[t]=o)}}),e[0]&&"object"==typeof e[0]&&Object.keys(e[0]).forEach(function(t){var r=e[0][t];void 0!==r&&(n[t]=e[0][t])}),new r(n)}t=t?[].concat(t):[],t.unshift("$namedParameters");var o=this.Register.Factory(e,t,c,n);return r.Interface&&o.interface(r.Interface),o}e.factories.factories.Service=function(r,n,c,o){function i(){var t=Array.prototype.slice.call(arguments);return t.unshift({}),e.instantiator(c,t)}return"function"==typeof n&&(o=c,c=n,n=null),"function"!=typeof c?this:c.extend&&c.Register&&c.Register.Factory?t.call(this,r,n,c,o):(n=n?[].concat(n):e.resolver.extractParameters(c),this.Register.Factory(r,n,i,o))}}(t),function(e){e.factories.wrapper=function(e){var t={interface:function(r){return e.interface=(e.interface||[]).concat(r),t},lifecycle:{application:function(){return e.lifecycle=1,t},class:function(){return e.lifecycle=2,t},instance:function(){return e.lifecycle=3,t},none:function(){return e.lifecycle=4,t}}};return t}}(t),function(e){e.instantiator=function(e,t){return new(Function.prototype.bind.apply(e,t))}}(t),function(e){e.jpexError=function(e){var t=new Error(e);throw t.jpexInternalError=!0,t}}(t),function(e){function t(e){return e&&(e.fn&&"function"==typeof e.fn||e.constant||e.resolved)}e.resolver.factoryService={getFactory:function(r,n,c){var o=r._resolved[n];if(!t(o)&&(o=r._factories[n],!t(o))){if(c)return;e.jpexError(["Unable to find required dependency:",n].join(" "))}return o},cacheResult:function(e,t,r,n,c){switch(r.lifecycle){case 1:r.resolved=!0,r.value=n;break;case 2:e._resolved[t]={resolved:!0,value:n};break;case 4:break;default:c[t]=n}return c}}}(t),function(e){function t(r,n,c){var o=[],i=e.typeof(n),a=e.typeof(c);if("array"===i)switch(n.iType){case"any":if("undefined"===a)return o.push("Must be defined"),o;return;case"either":for(var f=0;f<n.length;f++){var u=t(r,n[f],c);if(!u)return;o.push(r.Typeof(n[f]))}return[o.join("/")]}if(i!==a)return o.push("Not a",i),o;switch(i){case"function":case"object":Object.keys(n).forEach(function(e){var i=t(r,n[e],c[e]);i&&(o=o.concat([e,":"]).concat(i))});break;case"array":if(!n.length||!c.length)return;n=n[0];for(var s=0;s<c.length;s++){var l=t(r,n,c[s]);l&&(o=o.concat(l))}}return o.length?o:void 0}function r(e,t){var n=[].concat(t);return n.forEach(function(t){var c=e._interfaces[t];if(c&&c.interface&&c.interface.length){var o=c.interface.map(function(t){return r(e,t)});o&&o.length&&(n=n.concat.apply(n,o))}}),n}e.resolver.interfaceService={factoryImplements:function(e,t,n){var c=e._factories[t];return!!(c&&c.interface&&c.interface.length)&&(c.interfaceResolved||(c.interface=r(e,c.interface),c.interfaceResolved=!0),c.interface.indexOf(n)>-1)},findFactory:function(t,r){for(var n in t._factories)if(e.resolver.interfaceService.factoryImplements(t,n,r))return n;return r},validateInterface:function(r,n,c){if(void 0!==n){var o=t(r,n.pattern,c);if(o){var i=["Factory",n.name,"does not match interface pattern."].concat(o).join(" ");e.jpexError(i)}n.interface&&n.interface.forEach(function(e){return jpex.resolver.interfaceService.validateInterface(r,r._interfaces[e],c)})}}}}(t),function(e){var t=["number","boolean","string","array","function","date","regexp","null","undefined"];e.typeof=function(e){var r=Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase();return t.indexOf(r)<0?"object":r}}(t),function(t){function r(e){var t=this;e=n(e);var r=c(t,e);return a(r,t,e.dependencies),f(r),r}function n(e){var r={constructor:"function"==typeof e?e:null,invokeParent:!("function"==typeof e||e&&e.constructor),prototype:null,static:null,dependencies:[],interface:[],bindToInstance:!1};if(e&&"object"==typeof e){Object.keys(e);Object.keys(e).forEach(function(t){void 0!==r[t]&&(r[t]=e[t])})}return e&&!e.dependencies&&"function"==typeof r.constructor?r.dependencies=t.resolver.extractParameters(r.constructor):r.dependencies=[].concat(r.dependencies),r.dependencies.length||(r.dependencies=null),r.interface&&(r.interface=[].concat(r.interface)),r.interface.length||(r.interface=null),r}function c(e,t){var r=o(t);return r.prototype=Object.create(e.prototype),t.prototype&&Object.keys(t.prototype).forEach(function(e){r.prototype[e]=t.prototype[e]}),r.prototype.constructor=r,t.static&&Object.keys(t.static).forEach(function(e){r[e]=t.static[e]}),Object.keys(e).forEach(function(t){void 0===r[t]&&(r[t]=e[t])}),Object.defineProperties(r,{Dependencies:{get:function(){return t.dependencies}},Interface:{get:function(){return t.interface}}}),r}function o(e){var r;return r=function(n){if(!(this instanceof r))return new r(e);try{var c=t.resolver.resolveDependencies(r,{dependencies:e.dependencies},n);e.invokeParent&&"after"!==e.invokeParent&&r.InvokeParent(this,c,n),e.bindToInstance&&i(this,r,c,n,e.bindToInstance),"function"==typeof e.constructor&&e.constructor.apply(this,c),"after"===e.invokeParent&&r.InvokeParent(this,c,n)}catch(e){e&&e.jpexInternalError&&(e.stack=new Error(e.message).stack);var o=t.resolver.resolve(r,"_$errorHandler_",n);if(!o)throw e;o(e)}}}function i(e,t,r,n,c){var o=e;"string"==typeof c&&(o={},e[c]=o);var i=t.NamedParameters(r,n);Object.keys(i).forEach(function(e){o[e]=i[e]})}function a(e,r,n){t.privates.apply(e,r,n)}function f(e){t.factories.apply(e)}var u=function(){};u.extend=r;var s=u.extend();t.defaults.apply(s),e.Jpex=s}(t)}(window,{});